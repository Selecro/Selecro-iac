---
- name: Delete default dashboard service (if it exists in k3s-dashboard)
  kubernetes.core.k8s:
    state: absent
    kind: Service
    name: kubernetes-dashboard
    namespace: k3s-dashboard
    kubeconfig: /etc/rancher/k3s/k3s.yaml
  ignore_errors: yes

- name: Re-create dashboard service as ClusterIP (internal only)
  kubernetes.core.k8s:
    state: present
    definition:
      apiVersion: v1
      kind: Service
      metadata:
        name: kubernetes-dashboard
        namespace: k3s-dashboard
      spec:
        selector:
          k8s-app: kubernetes-dashboard
        ports:
          - port: 443
            targetPort: 8443
        type: ClusterIP
    kubeconfig: /etc/rancher/k3s/k3s.yaml

- name: Print Dashboard Tailscale Access Info
  debug:
    msg: |
      Dashboard is now only accessible via Tailscale proxy pod.
      From another Tailscale-connected device, access:
      http://<tailscale-pod-ip>:8080
      