- name: Apply Kubernetes Dashboard Manifests
  shell: |
    kubectl apply -f https://raw.githubusercontent.com/kubernetes/dashboard/v2.6.0/aio/deploy/recommended.yaml
  args:
    executable: /bin/bash

- name: Create Admin User
  copy:
    content: |
      apiVersion: v1
      kind: ServiceAccount
      metadata:
        name: admin-user
        namespace: kubernetes-dashboard
      ---
      apiVersion: rbac.authorization.k8s.io/v1
      kind: ClusterRoleBinding
      metadata:
        name: admin-user
      roleRef:
        apiGroup: rbac.authorization.k8s.io
        kind: ClusterRole
        name: cluster-admin
      subjects:
        - kind: ServiceAccount
          name: admin-user
          namespace: kubernetes-dashboard
    dest: /tmp/dashboard-admin.yaml

- name: Apply Admin User
  shell: kubectl apply -f /tmp/dashboard-admin.yaml

- name: Get Dashboard Admin Token
  shell: kubectl -n kubernetes-dashboard create token admin-user
  register: dashboard_token
  changed_when: false

- name: Show Dashboard Token
  debug:
    msg: "{{ dashboard_token.stdout }}"
